<?php

namespace Reliv\ServeStatic;

use Interop\Http\ServerMiddleware\DelegateInterface;
use Interop\Http\ServerMiddleware\MiddlewareInterface;
use Psr\Http\Message\ServerRequestInterface;
use Zend\Diactoros\Response;
use Zend\Diactoros\Response\HtmlResponse;

class ServeStaticMiddleware implements MiddlewareInterface
{
    protected $fileSystemPath;
    protected $options;

    public function __construct($fileSystemPath, $options = [])
    {
        $this->options = array_merge(
            [
                'notFoundResponseBody' => '404 - Not Found',
                'publicCachePath' => null,
                'unknownExtensionHeaders' => [],
                'extensionToHeaders' => [
                    'ez' => ['content-type' => 'application/andrew-inset',],
                    'atom' => ['content-type' => 'application/atom+xml',],
                    'atomcat' => ['content-type' => 'application/atomcat+xml',],
                    'atomsvc' => ['content-type' => 'application/atomsvc+xml',],
                    'apxml' => ['content-type' => 'application/auth-policy+xml',],
                    'ccxml' => ['content-type' => 'application/ccxml+xml',],
                    'cellml' => ['content-type' => 'application/cellml+xml',],
                    'cml' => ['content-type' => 'application/cellml+xml',],
                    'cpl' => ['content-type' => 'application/cpl+xml',],
                    'davmount' => ['content-type' => 'application/davmount+xml',],
                    'dcm' => ['content-type' => 'application/dicom',],
                    'dssc' => ['content-type' => 'application/dssc+der',],
                    'xdssc' => ['content-type' => 'application/dssc+xml',],
                    'dvc' => ['content-type' => 'application/dvcs',],
                    'emma' => ['content-type' => 'application/emma+xml',],
                    'finf' => ['content-type' => 'application/fastinfoset',],
                    'pfr' => ['content-type' => 'application/font-tdpfr',],
                    'stk' => ['content-type' => 'application/hyperstudio',],
                    'ipfix' => ['content-type' => 'application/ipfix',],
                    'json' => ['content-type' => 'application/json',],
                    'lostxml' => ['content-type' => 'application/lost+xml',],
                    'hqx' => ['content-type' => 'application/mac-binhex40',],
                    'mrc' => ['content-type' => 'application/marc',],
                    'nb' => ['content-type' => 'application/mathematica',],
                    'ma' => ['content-type' => 'application/mathematica',],
                    'mb' => ['content-type' => 'application/mathematica',],
                    'mbox' => ['content-type' => 'application/mbox',],
                    'm21' => ['content-type' => 'application/mp21',],
                    'mp21' => ['content-type' => 'application/mp21',],
                    'doc' => ['content-type' => 'application/msword',],
                    'mxf' => ['content-type' => 'application/mxf',],
                    'orq' => ['content-type' => 'application/ocsp-request',],
                    'ors' => ['content-type' => 'application/ocsp-response',],
                    'oda' => ['content-type' => 'application/oda',],
                    'opf' => ['content-type' => 'application/oebps-package+xml',],
                    'ogx' => ['content-type' => 'application/ogg',],
                    'pdf' => ['content-type' => 'application/pdf',],
                    'sig' => ['content-type' => 'application/pgp-signature',],
                    'p10' => ['content-type' => 'application/pkcs10',],
                    'p7m' => ['content-type' => 'application/pkcs7-mime',],
                    'p7c' => ['content-type' => 'application/pkcs7-mime',],
                    'p7s' => ['content-type' => 'application/pkcs7-signature',],
                    'cer' => ['content-type' => 'application/pkix-cert',],
                    'crl' => ['content-type' => 'application/pkix-crl',],
                    'pkipath' => ['content-type' => 'application/pkix-pkipath',],
                    'pls' => ['content-type' => 'application/pls+xml',],
                    'ai' => ['content-type' => 'application/postscript',],
                    'eps' => ['content-type' => 'application/postscript',],
                    'ps' => ['content-type' => 'application/postscript',],
                    'cw' => ['content-type' => 'application/prs.cww',],
                    'cww' => ['content-type' => 'application/prs.cww',],
                    'rnd' => ['content-type' => 'application/prs.nprend',],
                    'rct' => ['content-type' => 'application/prs.nprend',],
                    'rdf' => ['content-type' => 'application/rdf+xml',],
                    'rif' => ['content-type' => 'application/reginfo+xml',],
                    'rl' => ['content-type' => 'application/resource-lists+xml',],
                    'rs' => ['content-type' => 'application/rls-services+xml',],
                    'rtf' => ['content-type' => 'application/rtf',],
                    'scq' => ['content-type' => 'application/scvp-cv-request',],
                    'scs' => ['content-type' => 'application/scvp-cv-response',],
                    'spq' => ['content-type' => 'application/scvp-vp-request',],
                    'spp' => ['content-type' => 'application/scvp-vp-response',],
                    'sdp' => ['content-type' => 'application/sdp',],
                    'soc' => ['content-type' => 'application/sgml-open-catalog',],
                    'shf' => ['content-type' => 'application/shf+xml',],
                    'siv' => ['content-type' => 'application/sieve',],
                    'sieve' => ['content-type' => 'application/sieve',],
                    'cl' => ['content-type' => 'application/simple-filter+xml',],
                    'smil' => ['content-type' => 'application/smil',],
                    'smi' => ['content-type' => 'application/smil',],
                    'sml' => ['content-type' => 'application/smil',],
                    'rq' => ['content-type' => 'application/sparql-query',],
                    'srx' => ['content-type' => 'application/sparql-results+xml',],
                    'gram' => ['content-type' => 'application/srgs',],
                    'grxml' => ['content-type' => 'application/srgs+xml',],
                    'ssml' => ['content-type' => 'application/ssml+xml',],
                    'tsq' => ['content-type' => 'application/timestamp-query',],
                    'tsr' => ['content-type' => 'application/timestamp-reply',],
                    'pvb' => ['content-type' => 'application/vnd.3gpp.pic-bw-var',],
                    'sms' => ['content-type' => 'application/vnd.3gpp2.sms',],
                    'tcap' => ['content-type' => 'application/vnd.3gpp2.tcap',],
                    'acu' => ['content-type' => 'application/vnd.acucobol',],
                    'atc' => ['content-type' => 'application/vnd.acucorp',],
                    'acutc' => ['content-type' => 'application/vnd.acucorp',],
                    'xdp' => ['content-type' => 'application/vnd.adobe.xdp+xml',],
                    'xfdf' => ['content-type' => 'application/vnd.adobe.xfdf',],
                    'ami' => ['content-type' => 'application/vnd.amiga.ami',],
                    'm3u8' => ['content-type' => 'application/vnd.apple.mpegurl',],
                    'aep' => ['content-type' => 'application/vnd.audiograph',],
                    'package' => ['content-type' => 'application/vnd.autopackage',],
                    'bmi' => ['content-type' => 'application/vnd.bmi',],
                    'rep' => ['content-type' => 'application/vnd.businessobjects',],
                    'cdxml' => ['content-type' => 'application/vnd.chemdraw+xml',],
                    'cdy' => ['content-type' => 'application/vnd.cinderella',],
                    'cla' => ['content-type' => 'application/vnd.claymore',],
                    'rp9' => ['content-type' => 'application/vnd.cloanto.rp9',],
                    'c4g' => ['content-type' => 'application/vnd.clonk.c4group',],
                    'c4d' => ['content-type' => 'application/vnd.clonk.c4group',],
                    'c4f' => ['content-type' => 'application/vnd.clonk.c4group',],
                    'c4p' => ['content-type' => 'application/vnd.clonk.c4group',],
                    'c4u' => ['content-type' => 'application/vnd.clonk.c4group',],
                    'csp' => ['content-type' => 'application/vnd.commonspace',],
                    'cst' => ['content-type' => 'application/vnd.commonspace',],
                    'cdbcmsg' => ['content-type' => 'application/vnd.contact.cmsg',],
                    'cmc' => ['content-type' => 'application/vnd.cosmocaller',],
                    'clkx' => ['content-type' => 'application/vnd.crick.clicker',],
                    'pml' => ['content-type' => 'application/vnd.ctc-posml',],
                    'ppd' => ['content-type' => 'application/vnd.cups-ppd',],
                    'curl' => ['content-type' => 'application/vnd.curl',],
                    'rdz' => ['content-type' => 'application/vnd.data-vision.rdz',],
                    'dna' => ['content-type' => 'application/vnd.dna',],
                    'dpg' => ['content-type' => 'application/vnd.dpgraph',],
                    'mwc' => ['content-type' => 'application/vnd.dpgraph',],
                    'dpgraph' => ['content-type' => 'application/vnd.dpgraph',],
                    'dfac' => ['content-type' => 'application/vnd.dreamfactory',],
                    'geo' => ['content-type' => 'application/vnd.dynageo',],
                    'mag' => ['content-type' => 'application/vnd.ecowin.chart',],
                    'nml' => ['content-type' => 'application/vnd.enliven',],
                    'esf' => ['content-type' => 'application/vnd.epson.esf',],
                    'msf' => ['content-type' => 'application/vnd.epson.msf',],
                    'slt' => ['content-type' => 'application/vnd.epson.salt',],
                    'ssf' => ['content-type' => 'application/vnd.epson.ssf',],
                    'es3' => ['content-type' => 'application/vnd.eszigno3+xml',],
                    'et3' => ['content-type' => 'application/vnd.eszigno3+xml',],
                    'ez2' => ['content-type' => 'application/vnd.ezpix-album',],
                    'ez3' => ['content-type' => 'application/vnd.ezpix-package',],
                    'fdf' => ['content-type' => 'application/vnd.fdf',],
                    'msd' => ['content-type' => 'application/vnd.fdsn.mseed',],
                    'mseed' => ['content-type' => 'application/vnd.fdsn.mseed',],
                    'seed' => ['content-type' => 'application/vnd.fsdn.seed',],
                    'dataless' => ['content-type' => 'application/vnd.fsdn.seed',],
                    'gph' => ['content-type' => 'application/vnd.FloGraphIt',],
                    'ftc' => ['content-type' => 'application/vnd.fluxtime.clip',],
                    'fm' => ['content-type' => 'application/vnd.framemaker',],
                    'fnc' => ['content-type' => 'application/vnd.frogans.fnc',],
                    'ltf' => ['content-type' => 'application/vnd.frogans.ltf',],
                    'fsc' => ['content-type' => 'application/vnd.fsc.weblaunch',],
                    'oas' => ['content-type' => 'application/vnd.fujitsu.oasys',],
                    'oa2' => ['content-type' => 'application/vnd.fujitsu.oasys2',],
                    'oa3' => ['content-type' => 'application/vnd.fujitsu.oasys3',],
                    'fg5' => ['content-type' => 'application/vnd.fujitsu.oasysgp',],
                    'ddd' => ['content-type' => 'application/vnd.fujixerox.ddd',],
                    'fzs' => ['content-type' => 'application/vnd.fuzzysheet',],
                    'ggb' => ['content-type' => 'application/vnd.geogebra.file',],
                    'ggt' => ['content-type' => 'application/vnd.geogebra.tool',],
                    'gxt' => ['content-type' => 'application/vnd.geonext',],
                    'g2w' => ['content-type' => 'application/vnd.geoplan',],
                    'g3w' => ['content-type' => 'application/vnd.geospace',],
                    'gqf' => ['content-type' => 'application/vnd.grafeq',],
                    'gqs' => ['content-type' => 'application/vnd.grafeq',],
                    'gac' => ['content-type' => 'application/vnd.groove-account',],
                    'ghf' => ['content-type' => 'application/vnd.groove-help',],
                    'grv' => ['content-type' => 'application/vnd.groove-injector',],
                    'vcg' => ['content-type' => 'application/vnd.groove-vcard',],
                    'hbci' => ['content-type' => 'application/vnd.hbci',],
                    'hbc' => ['content-type' => 'application/vnd.hbci',],
                    'kom' => ['content-type' => 'application/vnd.hbci',],
                    'upa' => ['content-type' => 'application/vnd.hbci',],
                    'pkd' => ['content-type' => 'application/vnd.hbci',],
                    'bpd' => ['content-type' => 'application/vnd.hbci',],
                    'hpgl' => ['content-type' => 'application/vnd.hp-HPGL',],
                    'hpi' => ['content-type' => 'application/vnd.hp-hpid',],
                    'hpid' => ['content-type' => 'application/vnd.hp-hpid',],
                    'hps' => ['content-type' => 'application/vnd.hp-hps',],
                    'jlt' => ['content-type' => 'application/vnd.hp-jlyt',],
                    'pcl' => ['content-type' => 'application/vnd.hp-PCL',],
                    'mpy' => ['content-type' => 'application/vnd.ibm.MiniPay',],
                    'list3820' => ['content-type' => 'application/vnd.ibm.modcap',],
                    'listafp' => ['content-type' => 'application/vnd.ibm.modcap',],
                    'afp' => ['content-type' => 'application/vnd.ibm.modcap',],
                    'pseg3820' => ['content-type' => 'application/vnd.ibm.modcap',],
                    'icc' => ['content-type' => 'application/vnd.iccprofile',],
                    'icm' => ['content-type' => 'application/vnd.iccprofile',],
                    'igl' => ['content-type' => 'application/vnd.igloader',],
                    'ivp' => ['content-type' => 'application/vnd.immervision-ivp',],
                    'ivu' => ['content-type' => 'application/vnd.immervision-ivu',],
                    'qbo' => ['content-type' => 'application/vnd.intu.qbo',],
                    'qfx' => ['content-type' => 'application/vnd.intu.qfx',],
                    'xpr' => ['content-type' => 'application/vnd.is-xpr',],
                    'jam' => ['content-type' => 'application/vnd.jam',],
                    'jisp' => ['content-type' => 'application/vnd.jisp',],
                    'ktz' => ['content-type' => 'application/vnd.kahootz',],
                    'ktr' => ['content-type' => 'application/vnd.kahootz',],
                    'karbon' => ['content-type' => 'application/vnd.kde.karbon',],
                    'chrt' => ['content-type' => 'application/vnd.kde.kchart',],
                    'kfo' => ['content-type' => 'application/vnd.kde.kformula',],
                    'flw' => ['content-type' => 'application/vnd.kde.kivio',],
                    'kon' => ['content-type' => 'application/vnd.kde.kontour',],
                    'kpr' => ['content-type' => 'application/vnd.kde.kpresenter',],
                    'kpt' => ['content-type' => 'application/vnd.kde.kpresenter',],
                    'ksp' => ['content-type' => 'application/vnd.kde.kspread',],
                    'kwd' => ['content-type' => 'application/vnd.kde.kword',],
                    'kwt' => ['content-type' => 'application/vnd.kde.kword',],
                    'htke' => ['content-type' => 'application/vnd.kenameaapp',],
                    'kia' => ['content-type' => 'application/vnd.kidspiration',],
                    'kne' => ['content-type' => 'application/vnd.Kinar',],
                    'knp' => ['content-type' => 'application/vnd.Kinar',],
                    'sdf' => ['content-type' => 'application/vnd.Kinar',],
                    'skp' => ['content-type' => 'application/vnd.koan',],
                    'skd' => ['content-type' => 'application/vnd.koan',],
                    'skm' => ['content-type' => 'application/vnd.koan',],
                    'skt' => ['content-type' => 'application/vnd.koan',],
                    123 => ['content-type' => 'application/vnd.lotus-1-2-3',],
                    'wk4' => ['content-type' => 'application/vnd.lotus-1-2-3',],
                    'wk3' => ['content-type' => 'application/vnd.lotus-1-2-3',],
                    'wk1' => ['content-type' => 'application/vnd.lotus-1-2-3',],
                    'apr' => ['content-type' => 'application/vnd.lotus-approach',],
                    'vew' => ['content-type' => 'application/vnd.lotus-approach',],
                    'prz' => ['content-type' => 'application/vnd.lotus-freelance',],
                    'pre' => ['content-type' => 'application/vnd.lotus-freelance',],
                    'nsf' => ['content-type' => 'application/vnd.lotus-notes',],
                    'ntf' => ['content-type' => 'application/vnd.lotus-notes',],
                    'ndl' => ['content-type' => 'application/vnd.lotus-notes',],
                    'ns4' => ['content-type' => 'application/vnd.lotus-notes',],
                    'ns3' => ['content-type' => 'application/vnd.lotus-notes',],
                    'ns2' => ['content-type' => 'application/vnd.lotus-notes',],
                    'nsh' => ['content-type' => 'application/vnd.lotus-notes',],
                    'nsg' => ['content-type' => 'application/vnd.lotus-notes',],
                    'or3' => ['content-type' => 'application/vnd.lotus-organizer',],
                    'or2' => ['content-type' => 'application/vnd.lotus-organizer',],
                    'org' => ['content-type' => 'application/vnd.lotus-organizer',],
                    'scm' => ['content-type' => 'application/vnd.lotus-screencam',],
                    'lwp' => ['content-type' => 'application/vnd.lotus-wordpro',],
                    'sam' => ['content-type' => 'application/vnd.lotus-wordpro',],
                    'mdc' => ['content-type' => 'application/vnd.marlin.drm.mdcf',],
                    'mcd' => ['content-type' => 'application/vnd.mcd',],
                    'mc1' => ['content-type' => 'application/vnd.medcalcdata',],
                    'mwf' => ['content-type' => 'application/vnd.MFER',],
                    'mfm' => ['content-type' => 'application/vnd.mfmp',],
                    'flo' => ['content-type' => 'application/vnd.micrografx.flo',],
                    'igx' => ['content-type' => 'application/vnd.micrografx.igx',],
                    'mif' => ['content-type' => 'application/vnd.mif',],
                    'daf' => ['content-type' => 'application/vnd.Mobius.DAF',],
                    'dis' => ['content-type' => 'application/vnd.Mobius.DIS',],
                    'mbk' => ['content-type' => 'application/vnd.Mobius.MBK',],
                    'mqy' => ['content-type' => 'application/vnd.Mobius.MQY',],
                    'msl' => ['content-type' => 'application/vnd.Mobius.MSL',],
                    'plc' => ['content-type' => 'application/vnd.Mobius.PLC',],
                    'txf' => ['content-type' => 'application/vnd.Mobius.TXF',],
                    'xul' => ['content-type' => 'application/vnd.mozilla.xul+xml',],
                    'cil' => ['content-type' => 'application/vnd.ms-artgalry',],
                    'asf' => ['content-type' => 'application/vnd.ms-asf',],
                    'xls' => ['content-type' => 'application/vnd.ms-excel',],
                    'eot' => ['content-type' => 'application/vnd.ms-fontobject',],
                    'chm' => ['content-type' => 'application/vnd.ms-htmlhelp',],
                    'ims' => ['content-type' => 'application/vnd.ms-ims',],
                    'lrm' => ['content-type' => 'application/vnd.ms-lrm',],
                    'ppt' => ['content-type' => 'application/vnd.ms-powerpoint',],
                    'mpp' => ['content-type' => 'application/vnd.ms-project',],
                    'tnef' => ['content-type' => 'application/vnd.ms-tnef',],
                    'tnf' => ['content-type' => 'application/vnd.ms-tnef',],
                    'wcm' => ['content-type' => 'application/vnd.ms-works',],
                    'wdb' => ['content-type' => 'application/vnd.ms-works',],
                    'wks' => ['content-type' => 'application/vnd.ms-works',],
                    'wps' => ['content-type' => 'application/vnd.ms-works',],
                    'wpl' => ['content-type' => 'application/vnd.ms-wpl',],
                    'xps' => ['content-type' => 'application/vnd.ms-xpsdocument',],
                    'mseq' => ['content-type' => 'application/vnd.mseq',],
                    'crtr' => ['content-type' => 'application/vnd.multiad.creator',],
                    'mus' => ['content-type' => 'application/vnd.musician',],
                    'msty' => ['content-type' => 'application/vnd.muvee.style',],
                    'entity' => ['content-type' => 'application/vnd.nervana',],
                    'request' => ['content-type' => 'application/vnd.nervana',],
                    'bkm' => ['content-type' => 'application/vnd.nervana',],
                    'kcm' => ['content-type' => 'application/vnd.nervana',],
                    'nns' => ['content-type' => 'application/vnd.noblenet-sealer',],
                    'nnw' => ['content-type' => 'application/vnd.noblenet-web',],
                    'edm' => ['content-type' => 'application/vnd.novadigm.EDM',],
                    'edx' => ['content-type' => 'application/vnd.novadigm.EDX',],
                    'ext' => ['content-type' => 'application/vnd.novadigm.EXT',],
                    'odc' => ['content-type' => 'application/vnd.oasis.opendocument.chart',],
                    'odb' => ['content-type' => 'application/vnd.oasis.opendocument.database',],
                    'odf' => ['content-type' => 'application/vnd.oasis.opendocument.formula',],
                    'odg' => ['content-type' => 'application/vnd.oasis.opendocument.graphics',],
                    'odi' => ['content-type' => 'application/vnd.oasis.opendocument.image',],
                    'odp' => ['content-type' => 'application/vnd.oasis.opendocument.presentation',],
                    'ods' => ['content-type' => 'application/vnd.oasis.opendocument.spreadsheet',],
                    'odt' => ['content-type' => 'application/vnd.oasis.opendocument.text',],
                    'odm' => ['content-type' => 'application/vnd.oasis.opendocument.text-master',],
                    'oth' => ['content-type' => 'application/vnd.oasis.opendocument.text-web',],
                    'xo' => ['content-type' => 'application/vnd.olpc-sugar',],
                    'dd2' => ['content-type' => 'application/vnd.oma.dd2+xml',],
                    'ndc' => ['content-type' => 'application/vnd.osa.netdeploy',],
                    'dp' => ['content-type' => 'application/vnd.osgi.dp',],
                    'prc' => ['content-type' => 'application/vnd.palm',],
                    'pdb' => ['content-type' => 'application/vnd.palm',],
                    'pqa' => ['content-type' => 'application/vnd.palm',],
                    'oprc' => ['content-type' => 'application/vnd.palm',],
                    'ei6' => ['content-type' => 'application/vnd.pg.osasli',],
                    'efif' => ['content-type' => 'application/vnd.picsel',],
                    'plf' => ['content-type' => 'application/vnd.pocketlearn',],
                    'pbd' => ['content-type' => 'application/vnd.powerbuilder6',],
                    'preminet' => ['content-type' => 'application/vnd.preminet',],
                    'ptid' => ['content-type' => 'application/vnd.pvi.ptid1',],
                    'bed' => ['content-type' => 'application/vnd.realvnc.bed',],
                    'scd' => ['content-type' => 'application/vnd.scribus',],
                    'sla' => ['content-type' => 'application/vnd.scribus',],
                    'slaz' => ['content-type' => 'application/vnd.scribus',],
                    's3df' => ['content-type' => 'application/vnd.sealed.3df',],
                    'scsf' => ['content-type' => 'application/vnd.sealed.csf',],
                    'sdoc' => ['content-type' => 'application/vnd.sealed.doc',],
                    'sdo' => ['content-type' => 'application/vnd.sealed.doc',],
                    's1w' => ['content-type' => 'application/vnd.sealed.doc',],
                    'seml' => ['content-type' => 'application/vnd.sealed.eml',],
                    'sem' => ['content-type' => 'application/vnd.sealed.eml',],
                    'smht' => ['content-type' => 'application/vnd.sealed.mht',],
                    'smh' => ['content-type' => 'application/vnd.sealed.mht',],
                    'sppt' => ['content-type' => 'application/vnd.sealed.ppt',],
                    's1p' => ['content-type' => 'application/vnd.sealed.ppt',],
                    'stif' => ['content-type' => 'application/vnd.sealed.tiff',],
                    'sxls' => ['content-type' => 'application/vnd.sealed.xls',],
                    'sxl' => ['content-type' => 'application/vnd.sealed.xls',],
                    's1e' => ['content-type' => 'application/vnd.sealed.xls',],
                    'see' => ['content-type' => 'application/vnd.seemail',],
                    'sema' => ['content-type' => 'application/vnd.sema',],
                    'semd' => ['content-type' => 'application/vnd.semd',],
                    'semf' => ['content-type' => 'application/vnd.semf',],
                    'mmf' => ['content-type' => 'application/vnd.smaf',],
                    'teacher' => ['content-type' => 'application/vnd.smart.teacher',],
                    'sdkm' => ['content-type' => 'application/vnd.solent.sdkm+xml',],
                    'sdkd' => ['content-type' => 'application/vnd.solent.sdkm+xml',],
                    'dxp' => ['content-type' => 'application/vnd.spotfire.dxp',],
                    'sfs' => ['content-type' => 'application/vnd.spotfire.sfs',],
                    'wadl' => ['content-type' => 'application/vnd.sun.wadl+xml',],
                    'sus' => ['content-type' => 'application/vnd.sus-calendar',],
                    'susp' => ['content-type' => 'application/vnd.sus-calendar',],
                    'bdm' => ['content-type' => 'application/vnd.syncml.dm+wbxml',],
                    'xdm' => ['content-type' => 'application/vnd.syncml.dm+xml',],
                    'xsm' => ['content-type' => 'application/vnd.syncml+xml',],
                    'tmo' => ['content-type' => 'application/vnd.tmobile-livetv',],
                    'tpt' => ['content-type' => 'application/vnd.trid.tpt',],
                    'mxs' => ['content-type' => 'application/vnd.triscape.mxs',],
                    'tra' => ['content-type' => 'application/vnd.trueapp',],
                    'ufdl' => ['content-type' => 'application/vnd.ufdl',],
                    'ufd' => ['content-type' => 'application/vnd.ufdl',],
                    'frm' => ['content-type' => 'application/vnd.ufdl',],
                    'utz' => ['content-type' => 'application/vnd.uiq.theme',],
                    'umj' => ['content-type' => 'application/vnd.umajin',],
                    'unityweb' => ['content-type' => 'application/vnd.unity',],
                    'uoml' => ['content-type' => 'application/vnd.uoml+xml',],
                    'uo' => ['content-type' => 'application/vnd.uoml+xml',],
                    'vcx' => ['content-type' => 'application/vnd.vcx',],
                    'mxi' => ['content-type' => 'application/vnd.vd-study',],
                    'study-inter' => ['content-type' => 'application/vnd.vd-study',],
                    'model-inter' => ['content-type' => 'application/vnd.vd-study',],
                    'vwx' => ['content-type' => 'application/vnd.vectorworks',],
                    'vsd' => ['content-type' => 'application/vnd.visio',],
                    'vst' => ['content-type' => 'application/vnd.visio',],
                    'vsw' => ['content-type' => 'application/vnd.visio',],
                    'vss' => ['content-type' => 'application/vnd.visio',],
                    'vis' => ['content-type' => 'application/vnd.visionary',],
                    'vsf' => ['content-type' => 'application/vnd.vsf',],
                    'sic' => ['content-type' => 'application/vnd.wap.sic',],
                    'slc' => ['content-type' => 'application/vnd.wap.slc',],
                    'wbxml' => ['content-type' => 'application/vnd.wap.wbxml',],
                    'wmlc' => ['content-type' => 'application/vnd.wap.wmlc',],
                    'wmlsc' => ['content-type' => 'application/vnd.wap.wmlscriptc',],
                    'wtb' => ['content-type' => 'application/vnd.webturbo',],
                    'wsc' => ['content-type' => 'application/vnd.wfa.wsc',],
                    'wmc' => ['content-type' => 'application/vnd.wmc',],
                    'nbp' => ['content-type' => 'application/vnd.wolfram.player',],
                    'wpd' => ['content-type' => 'application/vnd.wordperfect',],
                    'wqd' => ['content-type' => 'application/vnd.wqd',],
                    'stf' => ['content-type' => 'application/vnd.wt.stf',],
                    'wv' => ['content-type' => 'application/vnd.wv.csp+wbxml',],
                    'xar' => ['content-type' => 'application/vnd.xara',],
                    'xfdl' => ['content-type' => 'application/vnd.xfdl',],
                    'xfd' => ['content-type' => 'application/vnd.xfdl',],
                    'cpkg' => ['content-type' => 'application/vnd.xmpie.cpkg',],
                    'dpkg' => ['content-type' => 'application/vnd.xmpie.dpkg',],
                    'ppkg' => ['content-type' => 'application/vnd.xmpie.ppkg',],
                    'xlim' => ['content-type' => 'application/vnd.xmpie.xlim',],
                    'hvd' => ['content-type' => 'application/vnd.yamaha.hv-dic',],
                    'hvp' => ['content-type' => 'application/vnd.yamaha.hv-voice',],
                    'zir' => ['content-type' => 'application/vnd.zul',],
                    'zirz' => ['content-type' => 'application/vnd.zul',],
                    'zaz' => ['content-type' => 'application/vnd.zzazz.deck+xml',],
                    'vxml' => ['content-type' => 'application/voicexml+xml',],
                    'wif' => ['content-type' => 'application/watcherinfo+xml',],
                    'wsdl' => ['content-type' => 'application/wsdl+xml',],
                    'wspolicy' => ['content-type' => 'application/wspolicy+xml',],
                    'xav' => ['content-type' => 'application/xcap-att+xml',],
                    'xca' => ['content-type' => 'application/xcap-caps+xml',],
                    'xel' => ['content-type' => 'application/xcap-el+xml',],
                    'xer' => ['content-type' => 'application/xcap-error+xml',],
                    'xns' => ['content-type' => 'application/xcap-ns+xml',],
                    'xhtml' => ['content-type' => 'application/xhtml+xml',],
                    'xhtm' => ['content-type' => 'application/xhtml+xml',],
                    'xht' => ['content-type' => 'application/xhtml+xml',],
                    'dtd' => ['content-type' => 'application/xml-dtd',],
                    'xop' => ['content-type' => 'application/xop+xml',],
                    'xsl' => ['content-type' => 'application/xslt+xml',],
                    'xslt' => ['content-type' => 'application/xslt+xml',],
                    'mxml' => ['content-type' => 'application/xv+xml',],
                    'xhvml' => ['content-type' => 'application/xv+xml',],
                    'xvml' => ['content-type' => 'application/xv+xml',],
                    'xvm' => ['content-type' => 'application/xv+xml',],
                    'zip' => ['content-type' => 'application/zip',],
                    'ac3' => ['content-type' => 'audio/ac3',],
                    'amr' => ['content-type' => 'audio/AMR',],
                    'awb' => ['content-type' => 'audio/AMR-WB',],
                    'aal' => ['content-type' => 'audio/ATRAC-ADVANCED-LOSSLESS',],
                    'atx' => ['content-type' => 'audio/ATRAC-X',],
                    'at3' => ['content-type' => 'audio/ATRAC3',],
                    'aa3' => ['content-type' => 'audio/ATRAC3',],
                    'omg' => ['content-type' => 'audio/ATRAC3',],
                    'au' => ['content-type' => 'audio/basic',],
                    'snd' => ['content-type' => 'audio/basic',],
                    'dls' => ['content-type' => 'audio/dls',],
                    'evc' => ['content-type' => 'audio/EVRC',],
                    'evb' => ['content-type' => 'audio/EVRCB',],
                    'evw' => ['content-type' => 'audio/EVRCWB',],
                    'lbc' => ['content-type' => 'audio/iLBC',],
                    'l16' => ['content-type' => 'audio/L16',],
                    'mxmf' => ['content-type' => 'audio/mobile-xmf',],
                    'mpga' => ['content-type' => 'audio/mpeg',],
                    'mp1' => ['content-type' => 'audio/mpeg',],
                    'mp2' => ['content-type' => 'audio/mpeg',],
                    'mp3' => ['content-type' => 'audio/mpeg',],
                    'oga' => ['content-type' => 'audio/ogg',],
                    'ogg' => ['content-type' => 'audio/ogg',],
                    'spx' => ['content-type' => 'audio/ogg',],
                    'sid' => ['content-type' => 'audio/prs.sid',],
                    'psid' => ['content-type' => 'audio/prs.sid',],
                    'qcp' => ['content-type' => 'audio/qcelp',],
                    'smv' => ['content-type' => 'audio/SMV',],
                    'koz' => ['content-type' => 'audio/vnd.audikoz',],
                    'eol' => ['content-type' => 'audio/vnd.digital-winds',],
                    'mlp' => ['content-type' => 'audio/vnd.dolby.mlp',],
                    'dts' => ['content-type' => 'audio/vnd.dts',],
                    'dtshd' => ['content-type' => 'audio/vnd.dts.hd',],
                    'plj' => ['content-type' => 'audio/vnd.everad.plj',],
                    'lvp' => ['content-type' => 'audio/vnd.lucent.voice',],
                    'vbk' => ['content-type' => 'audio/vnd.nortel.vbk',],
                    'ecelp4800' => ['content-type' => 'audio/vnd.nuera.ecelp4800',],
                    'ecelp7470' => ['content-type' => 'audio/vnd.nuera.ecelp7470',],
                    'ecelp9600' => ['content-type' => 'audio/vnd.nuera.ecelp9600',],
                    'fits' => ['content-type' => 'image/fits',],
                    'fit' => ['content-type' => 'image/fits',],
                    'fts' => ['content-type' => 'image/fits',],
                    'gif' => ['content-type' => 'image/gif',],
                    'ief' => ['content-type' => 'image/ief',],
                    'jp2' => ['content-type' => 'image/jp2',],
                    'jpg2' => ['content-type' => 'image/jp2',],
                    'jpeg' => ['content-type' => 'image/jpeg',],
                    'jpg' => ['content-type' => 'image/jpeg',],
                    'jpe' => ['content-type' => 'image/jpeg',],
                    'jfif' => ['content-type' => 'image/jpeg',],
                    'jpm' => ['content-type' => 'image/jpm',],
                    'jpgm' => ['content-type' => 'image/jpm',],
                    'jpx' => ['content-type' => 'image/jpx',],
                    'jpf' => ['content-type' => 'image/jpx',],
                    'png' => ['content-type' => 'image/png',],
                    'btif' => ['content-type' => 'image/prs.btif',],
                    'btf' => ['content-type' => 'image/prs.btif',],
                    'pti' => ['content-type' => 'image/prs.pti',],
                    't38' => ['content-type' => 'image/t38',],
                    'tiff' => ['content-type' => 'image/tiff',],
                    'tif' => ['content-type' => 'image/tiff',],
                    'tfx' => ['content-type' => 'image/tiff-fx',],
                    'psd' => ['content-type' => 'image/vnd.adobe.photoshop',],
                    'djvu' => ['content-type' => 'image/vnd.djvu',],
                    'djv' => ['content-type' => 'image/vnd.djvu',],
                    'dxf' => ['content-type' => 'image/vnd.dxf',],
                    'fbs' => ['content-type' => 'image/vnd.fastbidsheet',],
                    'fpx' => ['content-type' => 'image/vnd.fpx',],
                    'fst' => ['content-type' => 'image/vnd.fst',],
                    'mmr' => ['content-type' => 'image/vnd.fujixerox.edmics-mmr',],
                    'rlc' => ['content-type' => 'image/vnd.fujixerox.edmics-rlc',],
                    'pgb' => ['content-type' => 'image/vnd.globalgraphics.pgb',],
                    'ico' => ['content-type' => 'image/vnd.microsoft.icon',],
                    'mdi' => ['content-type' => 'image/vnd.ms-modi',],
                    'hdr' => ['content-type' => 'image/vnd.radiance',],
                    'rgbe' => ['content-type' => 'image/vnd.radiance',],
                    'xyze' => ['content-type' => 'image/vnd.radiance',],
                    'spng' => ['content-type' => 'image/vnd.sealed.png',],
                    'spn' => ['content-type' => 'image/vnd.sealed.png',],
                    's1n' => ['content-type' => 'image/vnd.sealed.png',],
                    'wbmp' => ['content-type' => 'image/vnd.wap.wbmp',],
                    'xif' => ['content-type' => 'image/vnd.xiff',],
                    'u8msg' => ['content-type' => 'message/global',],
                    'u8dsn' => ['content-type' => 'message/global-delivery-status',],
                    'u8hdr' => ['content-type' => 'message/global-headers',],
                    'eml' => ['content-type' => 'message/rfc822',],
                    'mail' => ['content-type' => 'message/rfc822',],
                    'art' => ['content-type' => 'message/rfc822',],
                    'igs' => ['content-type' => 'model/iges',],
                    'iges' => ['content-type' => 'model/iges',],
                    'msh' => ['content-type' => 'model/mesh',],
                    'mesh' => ['content-type' => 'model/mesh',],
                    'silo' => ['content-type' => 'model/mesh',],
                    'dwf' => ['content-type' => 'model/vnd.dwf',],
                    'gdl' => ['content-type' => 'model/vnd.gdl',],
                    'gsm' => ['content-type' => 'model/vnd.gdl',],
                    'win' => ['content-type' => 'model/vnd.gdl',],
                    'dor' => ['content-type' => 'model/vnd.gdl',],
                    'lmp' => ['content-type' => 'model/vnd.gdl',],
                    'rsm' => ['content-type' => 'model/vnd.gdl',],
                    'msm' => ['content-type' => 'model/vnd.gdl',],
                    'ism' => ['content-type' => 'model/vnd.gdl',],
                    'gtw' => ['content-type' => 'model/vnd.gtw',],
                    'moml' => ['content-type' => 'model/vnd.moml+xml',],
                    'mts' => ['content-type' => 'model/vnd.mts',],
                    'vtu' => ['content-type' => 'model/vnd.vtu',],
                    'wrl' => ['content-type' => 'model/vrml',],
                    'vrml' => ['content-type' => 'model/vrml',],
                    'vpm' => ['content-type' => 'multipart/voice-message',],
                    'ics' => ['content-type' => 'text/calendar',],
                    'ifb' => ['content-type' => 'text/calendar',],
                    'css' => ['content-type' => 'text/css',],
                    'csv' => ['content-type' => 'text/csv',],
                    'soa' => ['content-type' => 'text/dns',],
                    'zone' => ['content-type' => 'text/dns',],
                    'html' => ['content-type' => 'text/html',],
                    'htm' => ['content-type' => 'text/html',],
                    'js' => ['content-type' => 'text/javascript',],
                    'asc' => ['content-type' => 'text/plain',],
                    'txt' => ['content-type' => 'text/plain',],
                    'text' => ['content-type' => 'text/plain',],
                    'pm' => ['content-type' => 'text/plain',],
                    'el' => ['content-type' => 'text/plain',],
                    'c' => ['content-type' => 'text/plain',],
                    'h' => ['content-type' => 'text/plain',],
                    'cc' => ['content-type' => 'text/plain',],
                    'hh' => ['content-type' => 'text/plain',],
                    'cxx' => ['content-type' => 'text/plain',],
                    'hxx' => ['content-type' => 'text/plain',],
                    'f90' => ['content-type' => 'text/plain',],
                    'rst' => ['content-type' => 'text/prs.fallenstein.rst',],
                    'tag' => ['content-type' => 'text/prs.lines.tag',],
                    'dsc' => ['content-type' => 'text/prs.lines.tag',],
                    'rtx' => ['content-type' => 'text/richtext',],
                    'sgml' => ['content-type' => 'text/sgml',],
                    'sgm' => ['content-type' => 'text/sgml',],
                    'tsv' => ['content-type' => 'text/tab-separated-values',],
                    'uris' => ['content-type' => 'text/uri-list',],
                    'uri' => ['content-type' => 'text/uri-list',],
                    'abc' => ['content-type' => 'text/vnd.abc',],
                    'dms' => ['content-type' => 'text/vnd.DMClientScript',],
                    'fly' => ['content-type' => 'text/vnd.fly',],
                    'flx' => ['content-type' => 'text/vnd.fmi.flexstor',],
                    'gv' => ['content-type' => 'text/vnd.graphviz',],
                    'dot' => ['content-type' => 'text/vnd.graphviz',],
                    '3dml' => ['content-type' => 'text/vnd.in3d.3dml',],
                    '3dm' => ['content-type' => 'text/vnd.in3d.3dml',],
                    'spot' => ['content-type' => 'text/vnd.in3d.spot',],
                    'spo' => ['content-type' => 'text/vnd.in3d.spot',],
                    'mpf' => ['content-type' => 'text/vnd.ms-mediapackage',],
                    'uric' => ['content-type' => 'text/vnd.si.uricatalogue',],
                    'ts' => ['content-type' => 'text/vnd.trolltech.linguist',],
                    'si' => ['content-type' => 'text/vnd.wap.si',],
                    'sl' => ['content-type' => 'text/vnd.wap.sl',],
                    'wml' => ['content-type' => 'text/vnd.wap.wml',],
                    'wmls' => ['content-type' => 'text/vnd.wap.wmlscript',],
                    'xml' => ['content-type' => 'text/xml',],
                    'ent' => ['content-type' => 'text/xml-external-parsed-entity',],
                    '3gp' => ['content-type' => 'video/3gpp',],
                    '3gpp' => ['content-type' => 'video/3gpp',],
                    '3g2' => ['content-type' => 'video/3gpp2',],
                    '3gpp2' => ['content-type' => 'video/3gpp2',],
                    'mj2' => ['content-type' => 'video/mj2',],
                    'mjp2' => ['content-type' => 'video/mj2',],
                    'mp4' => ['content-type' => 'video/mp4',],
                    'mpg4' => ['content-type' => 'video/mp4',],
                    'mpeg' => ['content-type' => 'video/mpeg',],
                    'mpg' => ['content-type' => 'video/mpeg',],
                    'mpe' => ['content-type' => 'video/mpeg',],
                    'ogv' => ['content-type' => 'video/ogg',],
                    'qt' => ['content-type' => 'video/quicktime',],
                    'mov' => ['content-type' => 'video/quicktime',],
                    'fvt' => ['content-type' => 'video/vnd.fvt',],
                    'mxu' => ['content-type' => 'video/vnd.mpegurl',],
                    'm4u' => ['content-type' => 'video/vnd.mpegurl',],
                    'smpg' => ['content-type' => 'video/vnd.sealed.mpeg1',],
                    's11' => ['content-type' => 'video/vnd.sealed.mpeg1',],
                    's14' => ['content-type' => 'video/vnd.sealed.mpeg4',],
                    'sswf' => ['content-type' => 'video/vnd.sealed.swf',],
                    'ssw' => ['content-type' => 'video/vnd.sealed.swf',],
                    'cpt' => ['content-type' => 'application/mac-compactpro',],
                    'mml' => ['content-type' => 'application/mathml+xml',],
                    'metalink' => ['content-type' => 'application/metalink+xml',],
                    'rss' => ['content-type' => 'application/rss+xml',],
                    'dd' => ['content-type' => 'application/vnd.oma.dd+xml',],
                    'dcf' => ['content-type' => 'application/vnd.oma.drm.content',],
                    'o4a' => ['content-type' => 'application/vnd.oma.drm.dcf',],
                    'o4v' => ['content-type' => 'application/vnd.oma.drm.dcf',],
                    'dm' => ['content-type' => 'application/vnd.oma.drm.message',],
                    'sxc' => ['content-type' => 'application/vnd.sun.xml.calc',],
                    'sxd' => ['content-type' => 'application/vnd.sun.xml.draw',],
                    'sxi' => ['content-type' => 'application/vnd.sun.xml.impress',],
                    'sxm' => ['content-type' => 'application/vnd.sun.xml.math',],
                    'sxw' => ['content-type' => 'application/vnd.sun.xml.writer',],
                    'sis' => ['content-type' => 'application/vnd.symbian.install',],
                    'mms' => ['content-type' => 'application/vnd.wap.mms-message',],
                    'bcpio' => ['content-type' => 'application/x-bcpio',],
                    'torrent' => ['content-type' => 'application/x-bittorrent',],
                    'bz2' => ['content-type' => 'application/x-bzip2',],
                    'vcd' => ['content-type' => 'application/x-cdlink',],
                    'pgn' => ['content-type' => 'application/x-chess-pgn',],
                    'cpio' => ['content-type' => 'application/x-cpio',],
                    'csh' => ['content-type' => 'application/x-csh',],
                    'dcr' => ['content-type' => 'application/x-director',],
                    'dir' => ['content-type' => 'application/x-director',],
                    'dxr' => ['content-type' => 'application/x-director',],
                    'dvi' => ['content-type' => 'application/x-dvi',],
                    'spl' => ['content-type' => 'application/x-futuresplash',],
                    'gtar' => ['content-type' => 'application/x-gtar',],
                    'gz' => ['content-type' => 'application/x-gzip',],
                    'tgz' => ['content-type' => 'application/x-gzip',],
                    'hdf' => ['content-type' => 'application/x-hdf',],
                    'jar' => ['content-type' => 'application/x-java-archive',],
                    'jnlp' => ['content-type' => 'application/x-java-jnlp-file',],
                    'pack' => ['content-type' => 'application/x-java-pack200',],
                    'kil' => ['content-type' => 'application/x-killustrator',],
                    'latex' => ['content-type' => 'application/x-latex',],
                    'nc' => ['content-type' => 'application/x-netcdf',],
                    'cdf' => ['content-type' => 'application/x-netcdf',],
                    'pl' => ['content-type' => 'application/x-perl',],
                    'rpm' => ['content-type' => 'application/x-rpm',],
                    'sh' => ['content-type' => 'application/x-sh',],
                    'shar' => ['content-type' => 'application/x-shar',],
                    'swf' => ['content-type' => 'application/x-shockwave-flash',],
                    'sit' => ['content-type' => 'application/x-stuffit',],
                    'sv4cpio' => ['content-type' => 'application/x-sv4cpio',],
                    'sv4crc' => ['content-type' => 'application/x-sv4crc',],
                    'tar' => ['content-type' => 'application/x-tar',],
                    'tcl' => ['content-type' => 'application/x-tcl',],
                    'tex' => ['content-type' => 'application/x-tex',],
                    'texinfo' => ['content-type' => 'application/x-texinfo',],
                    'texi' => ['content-type' => 'application/x-texinfo',],
                    't' => ['content-type' => 'application/x-troff',],
                    'tr' => ['content-type' => 'application/x-troff',],
                    'roff' => ['content-type' => 'application/x-troff',],
                    'man' => ['content-type' => 'application/x-troff-man',],
                    1 => ['content-type' => 'application/x-troff-man',],
                    2 => ['content-type' => 'application/x-troff-man',],
                    3 => ['content-type' => 'application/x-troff-man',],
                    4 => ['content-type' => 'application/x-troff-man',],
                    5 => ['content-type' => 'application/x-troff-man',],
                    6 => ['content-type' => 'application/x-troff-man',],
                    7 => ['content-type' => 'application/x-troff-man',],
                    8 => ['content-type' => 'application/x-troff-man',],
                    'me' => ['content-type' => 'application/x-troff-me',],
                    'ms' => ['content-type' => 'application/x-troff-ms',],
                    'ustar' => ['content-type' => 'application/x-ustar',],
                    'src' => ['content-type' => 'application/x-wais-source',],
                    'xz' => ['content-type' => 'application/x-xz',],
                    'mid' => ['content-type' => 'audio/midi',],
                    'midi' => ['content-type' => 'audio/midi',],
                    'kar' => ['content-type' => 'audio/midi',],
                    'aif' => ['content-type' => 'audio/x-aiff',],
                    'aiff' => ['content-type' => 'audio/x-aiff',],
                    'aifc' => ['content-type' => 'audio/x-aiff',],
                    'mod' => ['content-type' => 'audio/x-mod',],
                    'ult' => ['content-type' => 'audio/x-mod',],
                    'uni' => ['content-type' => 'audio/x-mod',],
                    'm15' => ['content-type' => 'audio/x-mod',],
                    'mtm' => ['content-type' => 'audio/x-mod',],
                    669 => ['content-type' => 'audio/x-mod',],
                    'med' => ['content-type' => 'audio/x-mod',],
                    'm3u' => ['content-type' => 'audio/x-mpegurl',],
                    'wax' => ['content-type' => 'audio/x-ms-wax',],
                    'wma' => ['content-type' => 'audio/x-ms-wma',],
                    'ram' => ['content-type' => 'audio/x-pn-realaudio',],
                    'rm' => ['content-type' => 'audio/x-pn-realaudio',],
                    'ra' => ['content-type' => 'audio/x-realaudio',],
                    's3m' => ['content-type' => 'audio/x-s3m',],
                    'stm' => ['content-type' => 'audio/x-stm',],
                    'wav' => ['content-type' => 'audio/x-wav',],
                    'xyz' => ['content-type' => 'chemical/x-xyz',],
                    'bmp' => ['content-type' => 'image/bmp',],
                    'svg' => ['content-type' => 'image/svg+xml',],
                    'svgz' => ['content-type' => 'image/svg+xml',],
                    'ras' => ['content-type' => 'image/x-cmu-raster',],
                    'pnm' => ['content-type' => 'image/x-portable-anymap',],
                    'pbm' => ['content-type' => 'image/x-portable-bitmap',],
                    'pgm' => ['content-type' => 'image/x-portable-graymap',],
                    'ppm' => ['content-type' => 'image/x-portable-pixmap',],
                    'rgb' => ['content-type' => 'image/x-rgb',],
                    'tga' => ['content-type' => 'image/x-targa',],
                    'xbm' => ['content-type' => 'image/x-xbitmap',],
                    'xpm' => ['content-type' => 'image/x-xpixmap',],
                    'xwd' => ['content-type' => 'image/x-xwindowdump',],
                    'manifest' => ['content-type' => 'text/cache-manifest',],
                    'pod' => ['content-type' => 'text/x-pod',],
                    'etx' => ['content-type' => 'text/x-setext',],
                    'vcf' => ['content-type' => 'text/x-vcard',],
                    'webm' => ['content-type' => 'video/webm',],
                    'flv' => ['content-type' => 'video/x-flv',],
                    'asx' => ['content-type' => 'video/x-ms-asf',],
                    'wm' => ['content-type' => 'video/x-ms-wm',],
                    'wmv' => ['content-type' => 'video/x-ms-wmv',],
                    'wmx' => ['content-type' => 'video/x-ms-wmx',],
                    'wvx' => ['content-type' => 'video/x-ms-wvx',],
                    'avi' => ['content-type' => 'video/x-msvideo',],
                    'movie' => ['content-type' => 'video/x-sgi-movie',],
                    'ice' => ['content-type' => 'x-conference/x-cooltalk',],
                    'sisx' => ['content-type' => 'x-epoc/x-sisx-app',],
                    'exe' => ['content-type' => 'application/octet-stream'],
                ]
            ],
            $options
        );
        $this->fileSystemPath = $fileSystemPath;
    }

    public function process(
        ServerRequestInterface $request,
        DelegateInterface $delegate
    ) {
        $fileName = $request->getUri()->getPath();

        if (empty($fileName)) {
            return $this->options['notFoundResponse'];
        }

        $filePath = $this->fileSystemPath . $fileName;

        $filePath = realpath($filePath);

        // make sure file is real and is secure
        if (!strpos($filePath, realpath($this->fileSystemPath)) === 0 || !is_file($filePath)) {
            return $delegate->process($request);
        }

        $response = new Response();

        $body = $response->getBody();

        $content = file_get_contents($filePath);

        if ($this->options['publicCachePath'] !== null) {
            $writePath = $this->options['publicCachePath'] . $fileName;
            $writeDir = dirname($writePath);
            if (!is_dir($writeDir)) {
                mkdir($writeDir, 0777, true);
            }
            file_put_contents($writePath, $content);
        }

        $body->write($content);

        $extentsion = pathinfo($fileName)['extension'];
        if (array_key_exists($extentsion, $this->options['extensionToHeaders'])) {
            $headersToAdd = $this->options['extensionToHeaders'][$extentsion];
        } else {
            $headersToAdd = $this->options['unknownExtensionHeaders'];
        }

        foreach ($headersToAdd as $headerKey => $value) {
            $response = $response->withHeader($headerKey, $value);
        }

        return $response->withBody($body);
    }
}
